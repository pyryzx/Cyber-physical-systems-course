#define F_CPU 16000000UL
#define POWER_MODE SLEEP_MODE_IDLE
#include <stdbool.h>
#include <avr/io.h>
#include <avr/interrupt.h>
#include <avr/power.h>
#include <util/delay.h>
#include <avr/sleep.h>
volatile bool sleep_flag = false;
ISR(TIMER1_COMPA_vect){
 sleep_disable();
 //flag
 sleep_flag = true;
}
int main(void)
{
 
 DDRB |= (1 << PORTB5);
 TCCR1A = 0;
 TCCR1B = 0;
 TCNT1 = 0;
 // 1S * 15625 = 15625 = OCR1A = 15625
 OCR1A = 15625;
 TCCR1B |= (1 << WGM12); // CTC mode
 TCCR1B |= (1 << CS12) | (1 << CS10); // Prescaler 1024
 TIMSK1 |= (1 << OCIE1A);
 sei();
//configure the sleep lmode
 set_sleep_mode(POWER_MODE);
 sleep_enable();
sleep_cpu();
while(1)
 {
 if(sleep_flag) PORTB ^= (1 << PORTB5); 
 if(sleep_flag){
 sleep_flag = false;
 PORTB |= ( 1 << PORTB5);
 _delay_ms(100);
 PORTB &= ~(1 << PORTB5);
 sleep_cpu();
 }
 }
}
